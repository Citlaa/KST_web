{"remainingRequest":"/Users/nyg/Work/NayDev/KST_web/node_modules/babel-loader/lib/index.js!/Users/nyg/Work/NayDev/KST_web/node_modules/eslint-loader/index.js??ref--13-0!/Users/nyg/Work/NayDev/KST_web/src/store/modules/auth/actions.js","dependencies":[{"path":"/Users/nyg/Work/NayDev/KST_web/src/store/modules/auth/actions.js","mtime":1658286309360},{"path":"/Users/nyg/Work/NayDev/KST_web/node_modules/cache-loader/dist/cjs.js","mtime":1657481261281},{"path":"/Users/nyg/Work/NayDev/KST_web/node_modules/babel-loader/lib/index.js","mtime":1657481269361},{"path":"/Users/nyg/Work/NayDev/KST_web/node_modules/eslint-loader/index.js","mtime":1657481262523}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL1VzZXJzL255Zy9Xb3JrL05heURldi9LU1Rfd2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyIjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9Vc2Vycy9ueWcvV29yay9OYXlEZXYvS1NUX3dlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIjsKdmFyIHRpbWVyOwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgcm91dGVBUEkgZnJvbSAiQC9qcy9hcGkiOwpleHBvcnQgZGVmYXVsdCB7CiAgbG9naW46IGZ1bmN0aW9uIGxvZ2luKGNvbnRleHQsIHBheWxvYWQpIHsKICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBjb250ZXh0LmRpc3BhdGNoKCJhdXRoIiwgX29iamVjdFNwcmVhZCh7fSwgcGF5bG9hZCkpKTsKCiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZSk7CiAgICB9KSkoKTsKICB9LAogIGF1dGg6IGZ1bmN0aW9uIGF1dGgoY29udGV4dCwgcGF5bG9hZCkgewogICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgIHZhciB1cmwsIGRhdGEsIHJlc3BvbnNlLCBlcnJvciwgX2Vycm9yLCBleHBpcmVzSW4sIGV4cGlyYXRpb25EYXRlOwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICB1cmwgPSByb3V0ZUFQSSArICJhdXRoL3VzdWFyaW9zIjsKICAgICAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICAgICAgdXN1YXJpbzogewogICAgICAgICAgICAgICAgICBlbWFpbDogcGF5bG9hZC5lbWFpbCwKICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHBheWxvYWQucGFzc3dvcmQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNDsKICAgICAgICAgICAgICByZXR1cm4gYXhpb3MucG9zdCh1cmwsIGRhdGEpOwoKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQyLnNlbnQ7CgogICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuZGF0YS5oYXlFcnJvcikgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA5OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7CiAgICAgICAgICAgICAgZXJyb3IgPSBuZXcgRXJyb3IocmVzcG9uc2UuZGF0YS5lcnJvciB8fCAnTm8gc2UgcHVlZG8gYXV0ZW50aWNhciwgZmF2b3IgZGUgdm9sdmVybG8gYSBpbnRlbnRhci4nKTsKICAgICAgICAgICAgICB0aHJvdyBlcnJvcjsKCiAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICBpZiAoIShyZXNwb25zZS5kYXRhLnJlc3BvbnNlLmxlbmd0aCA8PSAwKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2Vycm9yID0gbmV3IEVycm9yKHJlc3BvbnNlLmRhdGEuZXJyb3IgfHwgJ0VsIHVzdWFyaW8gbyBsYSBjb250cmFzZcOxYSBubyBjb2luY2lkZSwgZmF2b3IgZGUgdmVyaWZpY2FybG8uJyk7CiAgICAgICAgICAgICAgdGhyb3cgX2Vycm9yOwoKICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICBleHBpcmVzSW4gPSArOTk5ICogMTAwMDsKICAgICAgICAgICAgICBleHBpcmF0aW9uRGF0ZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgZXhwaXJlc0luOwogICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJ1c2VySWQiLCByZXNwb25zZS5kYXRhLnJlc3BvbnNlWzBdWycwMTlBY3Rpdm8nXSk7CiAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oInRva2VuRXhwaXJhdGlvbiIsIGV4cGlyYXRpb25EYXRlKTsgLy8gdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIC8vICAgY29udGV4dC5kaXNwYXRjaCgiYXV0b0xvZ291dCIpOwogICAgICAgICAgICAgIC8vIH0sIGV4cGlyZXNJbik7CgogICAgICAgICAgICAgIGNvbnRleHQuY29tbWl0KCJzZXRVc2VyIiwgewogICAgICAgICAgICAgICAgdXNlcklkOiByZXNwb25zZS5kYXRhLnJlc3BvbnNlWzBdWycwMTlBY3Rpdm8nXQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUyKTsKICAgIH0pKSgpOwogIH0sCiAgbG9nb3V0OiBmdW5jdGlvbiBsb2dvdXQoY29udGV4dCkgewogICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oInVzZXJJZCIpOwogICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oInRva2VuRXhwaXJhdGlvbiIpOwogICAgY2xlYXJUaW1lb3V0KHRpbWVyKTsKICAgIGNvbnRleHQuY29tbWl0KCJzZXRVc2VyIiwgewogICAgICB1c2VySWQ6IG51bGwKICAgIH0pOwogIH0sCiAgYXV0b0xvZ291dDogZnVuY3Rpb24gYXV0b0xvZ291dChjb250ZXh0KSB7CiAgICBjb250ZXh0LmRpc3BhdGNoKCJsb2dvdXQiKTsKICAgIGNvbnRleHQuY29tbWl0KCJzZXRBdXRvTG9nb3V0Iik7CiAgfQp9Ow=="},{"version":3,"sources":["/Users/nyg/Work/NayDev/KST_web/src/store/modules/auth/actions.js"],"names":["timer","axios","routeAPI","login","context","payload","dispatch","auth","url","data","usuario","email","password","post","response","hayError","console","log","error","Error","length","expiresIn","expirationDate","Date","getTime","localStorage","setItem","commit","userId","logout","removeItem","clearTimeout","autoLogout"],"mappings":";;;AAAA,IAAIA,KAAJ;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,QAAP,MAAqB,UAArB;AAEA,eAAe;AACPC,EAAAA,KADO,iBACDC,OADC,EACQC,OADR,EACiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CACrBD,OAAO,CAACE,QAAR,CAAiB,MAAjB,oBACFD,OADE,EADqB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAI7B,GALY;AAMPE,EAAAA,IANO,gBAMFH,OANE,EAMOC,OANP,EAMgB;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AACvBG,cAAAA,GADuB,GACjBN,QAAQ,GAAG,eADM;AAErBO,cAAAA,IAFqB,GAEd;AACXC,gBAAAA,OAAO,EAAE;AACPC,kBAAAA,KAAK,EAAEN,OAAO,CAACM,KADR;AAEPC,kBAAAA,QAAQ,EAAEP,OAAO,CAACO;AAFX;AADE,eAFc;AAAA;AAAA,qBASJX,KAAK,CAACY,IAAN,CAAWL,GAAX,EAAgBC,IAAhB,CATI;;AAAA;AASrBK,cAAAA,QATqB;;AAAA,mBAWvBA,QAAQ,CAACL,IAAT,CAAcM,QAXS;AAAA;AAAA;AAAA;;AAYzBC,cAAAA,OAAO,CAACC,GAAR,CAAYH,QAAZ;AACMI,cAAAA,KAbmB,GAaX,IAAIC,KAAJ,CACZL,QAAQ,CAACL,IAAT,CAAcS,KAAd,IACE,uDAFU,CAbW;AAAA,oBAiBnBA,KAjBmB;;AAAA;AAAA,oBAoBxBJ,QAAQ,CAACL,IAAT,CAAcK,QAAd,CAAuBM,MAAvB,IAAiC,CApBT;AAAA;AAAA;AAAA;;AAqBnBF,cAAAA,MArBmB,GAqBX,IAAIC,KAAJ,CACZL,QAAQ,CAACL,IAAT,CAAcS,KAAd,IACE,+DAFU,CArBW;AAAA,oBAyBnBA,MAzBmB;;AAAA;AA4BrBG,cAAAA,SA5BqB,GA4BT,CAAC,GAAD,GAAO,IA5BE;AA6BrBC,cAAAA,cA7BqB,GA6BJ,IAAIC,IAAJ,GAAWC,OAAX,KAAuBH,SA7BnB;AA+B3BI,cAAAA,YAAY,CAACC,OAAb,CAAqB,QAArB,EAA+BZ,QAAQ,CAACL,IAAT,CAAcK,QAAd,CAAuB,CAAvB,EAA0B,WAA1B,CAA/B;AACAW,cAAAA,YAAY,CAACC,OAAb,CAAqB,iBAArB,EAAwCJ,cAAxC,EAhC2B,CAkC3B;AACA;AACA;;AAEAlB,cAAAA,OAAO,CAACuB,MAAR,CAAe,SAAf,EAA0B;AACxBC,gBAAAA,MAAM,EAAEd,QAAQ,CAACL,IAAT,CAAcK,QAAd,CAAuB,CAAvB,EAA0B,WAA1B;AADgB,eAA1B;;AAtC2B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAyC5B,GA/CY;AAgDbe,EAAAA,MAhDa,kBAgDNzB,OAhDM,EAgDG;AACdqB,IAAAA,YAAY,CAACK,UAAb,CAAwB,QAAxB;AACAL,IAAAA,YAAY,CAACK,UAAb,CAAwB,iBAAxB;AAEAC,IAAAA,YAAY,CAAC/B,KAAD,CAAZ;AAEAI,IAAAA,OAAO,CAACuB,MAAR,CAAe,SAAf,EAA0B;AACxBC,MAAAA,MAAM,EAAE;AADgB,KAA1B;AAGD,GAzDY;AA0DbI,EAAAA,UA1Da,sBA0DF5B,OA1DE,EA0DO;AAClBA,IAAAA,OAAO,CAACE,QAAR,CAAiB,QAAjB;AACAF,IAAAA,OAAO,CAACuB,MAAR,CAAe,eAAf;AACD;AA7DY,CAAf","sourcesContent":["let timer;\nimport axios from \"axios\";\nimport routeAPI from \"@/js/api\";\n\nexport default {\n  async login(context, payload) {\n    return context.dispatch(\"auth\", {\n      ...payload,\n    });\n  },\n  async auth(context, payload) {\n    let url = routeAPI + \"auth/usuarios\";\n    const data = {\n      usuario: {\n        email: payload.email,\n        password: payload.password,\n      },\n    };\n\n    const response = await axios.post(url, data);\n    \n    if (response.data.hayError) {\n      console.log(response);\n      const error = new Error(\n        response.data.error ||\n          'No se puedo autenticar, favor de volverlo a intentar.'\n      );\n      throw error;\n    }\n\n    if(response.data.response.length <= 0){\n      const error = new Error(\n        response.data.error ||\n          'El usuario o la contraseÃ±a no coincide, favor de verificarlo.'\n      );\n      throw error;\n    }\n    \n    const expiresIn = +999 * 1000;\n    const expirationDate = new Date().getTime() + expiresIn;    \n\n    localStorage.setItem(\"userId\", response.data.response[0]['019Activo']);\n    localStorage.setItem(\"tokenExpiration\", expirationDate);\n\n    // timer = setTimeout(function() {\n    //   context.dispatch(\"autoLogout\");\n    // }, expiresIn);\n\n    context.commit(\"setUser\", {\n      userId: response.data.response[0]['019Activo'],\n    });\n  },\n  logout(context) {\n    localStorage.removeItem(\"userId\");\n    localStorage.removeItem(\"tokenExpiration\");\n\n    clearTimeout(timer);\n    \n    context.commit(\"setUser\", {\n      userId: null,\n    });    \n  },\n  autoLogout(context) {\n    context.dispatch(\"logout\");\n    context.commit(\"setAutoLogout\");\n  },\n};\n"]}]}