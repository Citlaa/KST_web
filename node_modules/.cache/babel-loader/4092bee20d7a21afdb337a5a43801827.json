{"remainingRequest":"C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\src\\store\\modules\\auth\\actions.js","dependencies":[{"path":"C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\src\\store\\modules\\auth\\actions.js","mtime":1663125945568},{"path":"C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:bGV0IHRpbWVyOwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgcm91dGVBUEkgZnJvbSAiQC9qcy9hcGkiOwpleHBvcnQgZGVmYXVsdCB7CiAgYXN5bmMgbG9naW4oY29udGV4dCwgcGF5bG9hZCkgewogICAgcmV0dXJuIGNvbnRleHQuZGlzcGF0Y2goImF1dGgiLCB7IC4uLnBheWxvYWQKICAgIH0pOwogIH0sCgogIGFzeW5jIGF1dGgoY29udGV4dCwgcGF5bG9hZCkgewogICAgbGV0IHVybCA9IHJvdXRlQVBJICsgImF1dGgvdXN1YXJpb3MiOwogICAgY29uc3QgZGF0YSA9IHsKICAgICAgdXN1YXJpbzogewogICAgICAgIGVtYWlsOiBwYXlsb2FkLmVtYWlsLAogICAgICAgIHBhc3N3b3JkOiBwYXlsb2FkLnBhc3N3b3JkCiAgICAgIH0KICAgIH07CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLnBvc3QodXJsLCBkYXRhKTsKCiAgICBpZiAocmVzcG9uc2UuZGF0YS5oYXlFcnJvcikgewogICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7CiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKHJlc3BvbnNlLmRhdGEuZXJyb3IgfHwgJ05vIHNlIHB1ZWRvIGF1dGVudGljYXIsIGZhdm9yIGRlIHZvbHZlcmxvIGEgaW50ZW50YXIuJyk7CiAgICAgIHRocm93IGVycm9yOwogICAgfQoKICAgIGlmIChyZXNwb25zZS5kYXRhLnJlc3BvbnNlLmxlbmd0aCA8PSAwKSB7CiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKHJlc3BvbnNlLmRhdGEuZXJyb3IgfHwgJ0VsIHVzdWFyaW8gbyBsYSBjb250cmFzZcOxYSBubyBjb2luY2lkZSwgZmF2b3IgZGUgdmVyaWZpY2FybG8uJyk7CiAgICAgIHRocm93IGVycm9yOwogICAgfQoKICAgIGNvbnN0IGV4cGlyZXNJbiA9ICs5OTkgKiAxMDAwOwogICAgY29uc3QgZXhwaXJhdGlvbkRhdGUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIGV4cGlyZXNJbjsKICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJ1c2VySWQiLCByZXNwb25zZS5kYXRhLnJlc3BvbnNlWzBdWycwMTlBY3Rpdm8nXSk7CiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgidG9rZW5FeHBpcmF0aW9uIiwgZXhwaXJhdGlvbkRhdGUpOyAvLyB0aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAvLyAgIGNvbnRleHQuZGlzcGF0Y2goImF1dG9Mb2dvdXQiKTsKICAgIC8vIH0sIGV4cGlyZXNJbik7CgogICAgY29udGV4dC5jb21taXQoInNldFVzZXIiLCB7CiAgICAgIHVzZXJJZDogcmVzcG9uc2UuZGF0YS5yZXNwb25zZVswXVsnMDE5QWN0aXZvJ10KICAgIH0pOwogIH0sCgogIGxvZ291dChjb250ZXh0KSB7CiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgidXNlcklkIik7CiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgidG9rZW5FeHBpcmF0aW9uIik7CiAgICBjbGVhclRpbWVvdXQodGltZXIpOwogICAgY29udGV4dC5jb21taXQoInNldFVzZXIiLCB7CiAgICAgIHVzZXJJZDogbnVsbAogICAgfSk7CiAgfSwKCiAgYXV0b0xvZ291dChjb250ZXh0KSB7CiAgICBjb250ZXh0LmRpc3BhdGNoKCJsb2dvdXQiKTsKICAgIGNvbnRleHQuY29tbWl0KCJzZXRBdXRvTG9nb3V0Iik7CiAgfQoKfTs="},{"version":3,"sources":["C:/Users/MIlapDell/source/repos/KST/kst_web/src/store/modules/auth/actions.js"],"names":["timer","axios","routeAPI","login","context","payload","dispatch","auth","url","data","usuario","email","password","response","post","hayError","console","log","error","Error","length","expiresIn","expirationDate","Date","getTime","localStorage","setItem","commit","userId","logout","removeItem","clearTimeout","autoLogout"],"mappings":"AAAA,IAAIA,KAAJ;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,QAAP,MAAqB,UAArB;AAEA,eAAe;AACb,QAAMC,KAAN,CAAYC,OAAZ,EAAqBC,OAArB,EAA8B;AAC5B,WAAOD,OAAO,CAACE,QAAR,CAAiB,MAAjB,EAAyB,EAC9B,GAAGD;AAD2B,KAAzB,CAAP;AAGD,GALY;;AAMb,QAAME,IAAN,CAAWH,OAAX,EAAoBC,OAApB,EAA6B;AAC3B,QAAIG,GAAG,GAAGN,QAAQ,GAAG,eAArB;AACA,UAAMO,IAAI,GAAG;AACXC,MAAAA,OAAO,EAAE;AACPC,QAAAA,KAAK,EAAEN,OAAO,CAACM,KADR;AAEPC,QAAAA,QAAQ,EAAEP,OAAO,CAACO;AAFX;AADE,KAAb;AAOA,UAAMC,QAAQ,GAAG,MAAMZ,KAAK,CAACa,IAAN,CAAWN,GAAX,EAAgBC,IAAhB,CAAvB;;AAEA,QAAII,QAAQ,CAACJ,IAAT,CAAcM,QAAlB,EAA4B;AAC1BC,MAAAA,OAAO,CAACC,GAAR,CAAYJ,QAAZ;AACA,YAAMK,KAAK,GAAG,IAAIC,KAAJ,CACZN,QAAQ,CAACJ,IAAT,CAAcS,KAAd,IACE,uDAFU,CAAd;AAIA,YAAMA,KAAN;AACD;;AAED,QAAGL,QAAQ,CAACJ,IAAT,CAAcI,QAAd,CAAuBO,MAAvB,IAAiC,CAApC,EAAsC;AACpC,YAAMF,KAAK,GAAG,IAAIC,KAAJ,CACZN,QAAQ,CAACJ,IAAT,CAAcS,KAAd,IACE,+DAFU,CAAd;AAIA,YAAMA,KAAN;AACD;;AAED,UAAMG,SAAS,GAAG,CAAC,GAAD,GAAO,IAAzB;AACA,UAAMC,cAAc,GAAG,IAAIC,IAAJ,GAAWC,OAAX,KAAuBH,SAA9C;AAEAI,IAAAA,YAAY,CAACC,OAAb,CAAqB,QAArB,EAA+Bb,QAAQ,CAACJ,IAAT,CAAcI,QAAd,CAAuB,CAAvB,EAA0B,WAA1B,CAA/B;AACAY,IAAAA,YAAY,CAACC,OAAb,CAAqB,iBAArB,EAAwCJ,cAAxC,EAhC2B,CAkC3B;AACA;AACA;;AAEAlB,IAAAA,OAAO,CAACuB,MAAR,CAAe,SAAf,EAA0B;AACxBC,MAAAA,MAAM,EAAEf,QAAQ,CAACJ,IAAT,CAAcI,QAAd,CAAuB,CAAvB,EAA0B,WAA1B;AADgB,KAA1B;AAGD,GA/CY;;AAgDbgB,EAAAA,MAAM,CAACzB,OAAD,EAAU;AACdqB,IAAAA,YAAY,CAACK,UAAb,CAAwB,QAAxB;AACAL,IAAAA,YAAY,CAACK,UAAb,CAAwB,iBAAxB;AAEAC,IAAAA,YAAY,CAAC/B,KAAD,CAAZ;AAEAI,IAAAA,OAAO,CAACuB,MAAR,CAAe,SAAf,EAA0B;AACxBC,MAAAA,MAAM,EAAE;AADgB,KAA1B;AAGD,GAzDY;;AA0DbI,EAAAA,UAAU,CAAC5B,OAAD,EAAU;AAClBA,IAAAA,OAAO,CAACE,QAAR,CAAiB,QAAjB;AACAF,IAAAA,OAAO,CAACuB,MAAR,CAAe,eAAf;AACD;;AA7DY,CAAf","sourcesContent":["let timer;\r\nimport axios from \"axios\";\r\nimport routeAPI from \"@/js/api\";\r\n\r\nexport default {\r\n  async login(context, payload) {\r\n    return context.dispatch(\"auth\", {\r\n      ...payload,\r\n    });\r\n  },\r\n  async auth(context, payload) {\r\n    let url = routeAPI + \"auth/usuarios\";\r\n    const data = {\r\n      usuario: {\r\n        email: payload.email,\r\n        password: payload.password,\r\n      },\r\n    };\r\n\r\n    const response = await axios.post(url, data);\r\n    \r\n    if (response.data.hayError) {\r\n      console.log(response);\r\n      const error = new Error(\r\n        response.data.error ||\r\n          'No se puedo autenticar, favor de volverlo a intentar.'\r\n      );\r\n      throw error;\r\n    }\r\n\r\n    if(response.data.response.length <= 0){\r\n      const error = new Error(\r\n        response.data.error ||\r\n          'El usuario o la contraseÃ±a no coincide, favor de verificarlo.'\r\n      );\r\n      throw error;\r\n    }\r\n    \r\n    const expiresIn = +999 * 1000;\r\n    const expirationDate = new Date().getTime() + expiresIn;    \r\n\r\n    localStorage.setItem(\"userId\", response.data.response[0]['019Activo']);\r\n    localStorage.setItem(\"tokenExpiration\", expirationDate);\r\n\r\n    // timer = setTimeout(function() {\r\n    //   context.dispatch(\"autoLogout\");\r\n    // }, expiresIn);\r\n\r\n    context.commit(\"setUser\", {\r\n      userId: response.data.response[0]['019Activo'],\r\n    });\r\n  },\r\n  logout(context) {\r\n    localStorage.removeItem(\"userId\");\r\n    localStorage.removeItem(\"tokenExpiration\");\r\n\r\n    clearTimeout(timer);\r\n    \r\n    context.commit(\"setUser\", {\r\n      userId: null,\r\n    });    \r\n  },\r\n  autoLogout(context) {\r\n    context.dispatch(\"logout\");\r\n    context.commit(\"setAutoLogout\");\r\n  },\r\n};\r\n"]}]}