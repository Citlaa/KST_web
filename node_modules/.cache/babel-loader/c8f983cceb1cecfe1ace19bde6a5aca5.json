{"remainingRequest":"C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\src\\store\\modules\\auth\\actions.js","dependencies":[{"path":"C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\src\\store\\modules\\auth\\actions.js","mtime":1658187536174},{"path":"C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiQzovVXNlcnMvTUlsYXBEZWxsL3NvdXJjZS9yZXBvcy9LU1Qva3N0X3dlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMiI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJDOi9Vc2Vycy9NSWxhcERlbGwvc291cmNlL3JlcG9zL0tTVC9rc3Rfd2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwp2YXIgdGltZXI7CmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCByb3V0ZUFQSSBmcm9tICJAL2pzL2FwaSI7CmV4cG9ydCBkZWZhdWx0IHsKICBsb2dpbjogZnVuY3Rpb24gbG9naW4oY29udGV4dCwgcGF5bG9hZCkgewogICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGNvbnRleHQuZGlzcGF0Y2goImF1dGgiLCBfb2JqZWN0U3ByZWFkKHt9LCBwYXlsb2FkKSkpOwoKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlKTsKICAgIH0pKSgpOwogIH0sCiAgYXV0aDogZnVuY3Rpb24gYXV0aChjb250ZXh0LCBwYXlsb2FkKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICB2YXIgdXJsLCBkYXRhLCByZXNwb25zZSwgZXhwaXJlc0luLCBleHBpcmF0aW9uRGF0ZTsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICB1cmwgPSByb3V0ZUFQSSArICIiOwogICAgICAgICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICAgICBlbWFpbDogcGF5bG9hZC5lbWFpbCwKICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXlsb2FkLnBhc3N3b3JkCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgcmV0dXJuIGF4aW9zLnBvc3QodXJsLCBkYXRhKTsKCiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0Mi5zZW50OwoKICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmRhdGEuaGF5RXJyb3IpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gOTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpOwoKICAgICAgICAgICAgICBfdGhpcy4kYWxlcnQoIk5vIHNlIHB1ZWRvIGF1dGVudGljYXIsIGZhdm9yIGRlIHZvbHZlcmxvIGEgaW50ZW50YXIuIik7CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICBleHBpcmVzSW4gPSArcmVzcG9uc2UuZXhwaXJlc0luICogMTAwMDsKICAgICAgICAgICAgICBleHBpcmF0aW9uRGF0ZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgZXhwaXJlc0luOwogICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJ1c2VySWQiLCByZXNwb25zZS5sb2NhbElkKTsKICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgidG9rZW5FeHBpcmF0aW9uIiwgZXhwaXJhdGlvbkRhdGUpOwogICAgICAgICAgICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBjb250ZXh0LmRpc3BhdGNoKCJhdXRvTG9nb3V0Iik7CiAgICAgICAgICAgICAgfSwgZXhwaXJlc0luKTsKICAgICAgICAgICAgICBjb250ZXh0LmNvbW1pdCgic2V0VXNlciIsIHsKICAgICAgICAgICAgICAgIHRva2VuOiByZXNwb25zZS5pZFRva2VuLAogICAgICAgICAgICAgICAgdXNlcklkOiByZXNwb25zZS5sb2NhbElkCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZTIpOwogICAgfSkpKCk7CiAgfSwKICBsb2dvdXQ6IGZ1bmN0aW9uIGxvZ291dChjb250ZXh0KSB7CiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgndXNlcklkJyk7CiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgndG9rZW5FeHBpcmF0aW9uJyk7CiAgICBjbGVhclRpbWVvdXQodGltZXIpOwogICAgY29udGV4dC5jb21taXQoJ3NldFVzZXInLCB7CiAgICAgIHVzZXJJZDogbnVsbAogICAgfSk7CiAgfSwKICBhdXRvTG9nb3V0OiBmdW5jdGlvbiBhdXRvTG9nb3V0KGNvbnRleHQpIHsKICAgIGNvbnRleHQuZGlzcGF0Y2goJ2xvZ291dCcpOwogICAgY29udGV4dC5jb21taXQoJ3NldEF1dG9Mb2dvdXQnKTsKICB9Cn07"},{"version":3,"sources":["C:/Users/MIlapDell/source/repos/KST/kst_web/src/store/modules/auth/actions.js"],"names":["timer","axios","routeAPI","login","context","payload","dispatch","auth","url","data","email","password","post","response","hayError","console","log","$alert","expiresIn","expirationDate","Date","getTime","localStorage","setItem","localId","setTimeout","commit","token","idToken","userId","logout","removeItem","clearTimeout","autoLogout"],"mappings":";;;AAAA,IAAIA,KAAJ;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,QAAP,MAAqB,UAArB;AAEA,eAAe;AACPC,EAAAA,KADO,iBACDC,OADC,EACQC,OADR,EACiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CACrBD,OAAO,CAACE,QAAR,CAAiB,MAAjB,oBACFD,OADE,EADqB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAI7B,GALY;AAMPE,EAAAA,IANO,gBAMFH,OANE,EAMOC,OANP,EAMgB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACvBG,cAAAA,GADuB,GACjBN,QAAQ,GAAG,EADM;AAErBO,cAAAA,IAFqB,GAEd;AACXC,gBAAAA,KAAK,EAAEL,OAAO,CAACK,KADJ;AAEXC,gBAAAA,QAAQ,EAAEN,OAAO,CAACM;AAFP,eAFc;AAAA;AAAA,qBAOJV,KAAK,CAACW,IAAN,CAAWJ,GAAX,EAAgBC,IAAhB,CAPI;;AAAA;AAOrBI,cAAAA,QAPqB;;AAAA,mBASvBA,QAAQ,CAACJ,IAAT,CAAcK,QATS;AAAA;AAAA;AAAA;;AAUzBC,cAAAA,OAAO,CAACC,GAAR,CAAYH,QAAZ;;AACA,cAAA,KAAI,CAACI,MAAL,CAAY,uDAAZ;;AAXyB;;AAAA;AAerBC,cAAAA,SAfqB,GAeT,CAACL,QAAQ,CAACK,SAAV,GAAsB,IAfb;AAgBrBC,cAAAA,cAhBqB,GAgBJ,IAAIC,IAAJ,GAAWC,OAAX,KAAuBH,SAhBnB;AAkB3BI,cAAAA,YAAY,CAACC,OAAb,CAAqB,QAArB,EAA+BV,QAAQ,CAACW,OAAxC;AACAF,cAAAA,YAAY,CAACC,OAAb,CAAqB,iBAArB,EAAwCJ,cAAxC;AAEAnB,cAAAA,KAAK,GAAGyB,UAAU,CAAC,YAAW;AAC5BrB,gBAAAA,OAAO,CAACE,QAAR,CAAiB,YAAjB;AACD,eAFiB,EAEfY,SAFe,CAAlB;AAIAd,cAAAA,OAAO,CAACsB,MAAR,CAAe,SAAf,EAA0B;AACxBC,gBAAAA,KAAK,EAAEd,QAAQ,CAACe,OADQ;AAExBC,gBAAAA,MAAM,EAAEhB,QAAQ,CAACW;AAFO,eAA1B;;AAzB2B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA6B5B,GAnCY;AAoCbM,EAAAA,MApCa,kBAoCN1B,OApCM,EAoCG;AACdkB,IAAAA,YAAY,CAACS,UAAb,CAAwB,QAAxB;AACAT,IAAAA,YAAY,CAACS,UAAb,CAAwB,iBAAxB;AAEAC,IAAAA,YAAY,CAAChC,KAAD,CAAZ;AAEAI,IAAAA,OAAO,CAACsB,MAAR,CAAe,SAAf,EAA0B;AACxBG,MAAAA,MAAM,EAAE;AADgB,KAA1B;AAGD,GA7CY;AA8CbI,EAAAA,UA9Ca,sBA8CF7B,OA9CE,EA8CM;AACjBA,IAAAA,OAAO,CAACE,QAAR,CAAiB,QAAjB;AACAF,IAAAA,OAAO,CAACsB,MAAR,CAAe,eAAf;AACD;AAjDY,CAAf","sourcesContent":["let timer;\r\nimport axios from \"axios\";\r\nimport routeAPI from \"@/js/api\";\r\n\r\nexport default {\r\n  async login(context, payload) {\r\n    return context.dispatch(\"auth\", {\r\n      ...payload,\r\n    });\r\n  },\r\n  async auth(context, payload) {\r\n    let url = routeAPI + \"\";\r\n    const data = {\r\n      email: payload.email,\r\n      password: payload.password,\r\n    };\r\n\r\n    const response = await axios.post(url, data);\r\n\r\n    if (response.data.hayError) {\r\n      console.log(response);\r\n      this.$alert(\"No se puedo autenticar, favor de volverlo a intentar.\");\r\n      return ;\r\n    }\r\n\r\n    const expiresIn = +response.expiresIn * 1000;\r\n    const expirationDate = new Date().getTime() + expiresIn;\r\n\r\n    localStorage.setItem(\"userId\", response.localId);\r\n    localStorage.setItem(\"tokenExpiration\", expirationDate);\r\n\r\n    timer = setTimeout(function() {\r\n      context.dispatch(\"autoLogout\");\r\n    }, expiresIn);\r\n\r\n    context.commit(\"setUser\", {\r\n      token: response.idToken,\r\n      userId: response.localId,\r\n    });\r\n  },\r\n  logout(context) {\r\n    localStorage.removeItem('userId');\r\n    localStorage.removeItem('tokenExpiration');\r\n\r\n    clearTimeout(timer);\r\n\r\n    context.commit('setUser', {\r\n      userId: null,\r\n    });\r\n  },\r\n  autoLogout(context){\r\n    context.dispatch('logout');\r\n    context.commit('setAutoLogout');\r\n  }\r\n};\r\n"]}]}