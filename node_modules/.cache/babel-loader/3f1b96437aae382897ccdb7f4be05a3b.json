{"remainingRequest":"C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\src\\store\\modules\\auth\\actions.js","dependencies":[{"path":"C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\src\\store\\modules\\auth\\actions.js","mtime":1658205126970},{"path":"C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\MIlapDell\\source\\repos\\KST\\kst_web\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiQzovVXNlcnMvTUlsYXBEZWxsL3NvdXJjZS9yZXBvcy9LU1Qva3N0X3dlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMiI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJDOi9Vc2Vycy9NSWxhcERlbGwvc291cmNlL3JlcG9zL0tTVC9rc3Rfd2ViL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwp2YXIgdGltZXI7CmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCByb3V0ZUFQSSBmcm9tICJAL2pzL2FwaSI7CmV4cG9ydCBkZWZhdWx0IHsKICBsb2dpbjogZnVuY3Rpb24gbG9naW4oY29udGV4dCwgcGF5bG9hZCkgewogICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGNvbnRleHQuZGlzcGF0Y2goImF1dGgiLCBfb2JqZWN0U3ByZWFkKHt9LCBwYXlsb2FkKSkpOwoKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlKTsKICAgIH0pKSgpOwogIH0sCiAgYXV0aDogZnVuY3Rpb24gYXV0aChjb250ZXh0LCBwYXlsb2FkKSB7CiAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgdmFyIHVybCwgZGF0YSwgcmVzcG9uc2UsIGVycm9yLCBfZXJyb3IsIGV4cGlyZXNJbiwgZXhwaXJhdGlvbkRhdGU7CgogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHVybCA9IHJvdXRlQVBJICsgImF1dGgvdXN1YXJpb3MiOwogICAgICAgICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICAgICB1c3VhcmlvOiB7CiAgICAgICAgICAgICAgICAgIGVtYWlsOiBwYXlsb2FkLmVtYWlsLAogICAgICAgICAgICAgICAgICBwYXNzd29yZDogcGF5bG9hZC5wYXNzd29yZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA0OwogICAgICAgICAgICAgIHJldHVybiBheGlvcy5wb3N0KHVybCwgZGF0YSk7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dDIuc2VudDsKCiAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5kYXRhLmhheUVycm9yKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTsKICAgICAgICAgICAgICBlcnJvciA9IG5ldyBFcnJvcihyZXNwb25zZS5kYXRhLmVycm9yIHx8ICdObyBzZSBwdWVkbyBhdXRlbnRpY2FyLCBmYXZvciBkZSB2b2x2ZXJsbyBhIGludGVudGFyLicpOwogICAgICAgICAgICAgIHRocm93IGVycm9yOwoKICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgIGlmICghKHJlc3BvbnNlLmRhdGEucmVzcG9uc2UubGVuZ3RoIDw9IDApKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfZXJyb3IgPSBuZXcgRXJyb3IocmVzcG9uc2UuZGF0YS5lcnJvciB8fCAnRWwgdXN1YXJpbyBvIGxhIGNvbnRyYXNlw7FhIG5vIGNvaW5jaWRlLCBmYXZvciBkZSB2ZXJpZmljYXJsby4nKTsKICAgICAgICAgICAgICB0aHJvdyBfZXJyb3I7CgogICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgIGV4cGlyZXNJbiA9ICsxMTAgKiAxMDAwOwogICAgICAgICAgICAgIGV4cGlyYXRpb25EYXRlID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgKyBleHBpcmVzSW47CiAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oInVzZXJJZCIsIHJlc3BvbnNlLmxvY2FsSWQpOwogICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJ0b2tlbkV4cGlyYXRpb24iLCBleHBpcmF0aW9uRGF0ZSk7CiAgICAgICAgICAgICAgdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGNvbnRleHQuZGlzcGF0Y2goImF1dG9Mb2dvdXQiKTsKICAgICAgICAgICAgICB9LCBleHBpcmVzSW4pOwogICAgICAgICAgICAgIGNvbnRleHQuY29tbWl0KCJzZXRVc2VyIiwgewogICAgICAgICAgICAgICAgdXNlcklkOiByZXNwb25zZS5kYXRhLnJlc3BvbnNlWzBdWycwMTlBY3Rpdm8nXQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUyKTsKICAgIH0pKSgpOwogIH0sCiAgbG9nb3V0OiBmdW5jdGlvbiBsb2dvdXQoY29udGV4dCkgewogICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oInVzZXJJZCIpOwogICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oInRva2VuRXhwaXJhdGlvbiIpOwogICAgY2xlYXJUaW1lb3V0KHRpbWVyKTsKICAgIGNvbnRleHQuY29tbWl0KCJzZXRVc2VyIiwgewogICAgICB1c2VySWQ6IG51bGwKICAgIH0pOwogIH0sCiAgYXV0b0xvZ291dDogZnVuY3Rpb24gYXV0b0xvZ291dChjb250ZXh0KSB7CiAgICBjb250ZXh0LmRpc3BhdGNoKCJsb2dvdXQiKTsKICAgIGNvbnRleHQuY29tbWl0KCJzZXRBdXRvTG9nb3V0Iik7CiAgfQp9Ow=="},{"version":3,"sources":["C:/Users/MIlapDell/source/repos/KST/kst_web/src/store/modules/auth/actions.js"],"names":["timer","axios","routeAPI","login","context","payload","dispatch","auth","url","data","usuario","email","password","post","response","hayError","console","log","error","Error","length","expiresIn","expirationDate","Date","getTime","localStorage","setItem","localId","setTimeout","commit","userId","logout","removeItem","clearTimeout","autoLogout"],"mappings":";;;AAAA,IAAIA,KAAJ;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,QAAP,MAAqB,UAArB;AAEA,eAAe;AACPC,EAAAA,KADO,iBACDC,OADC,EACQC,OADR,EACiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CACrBD,OAAO,CAACE,QAAR,CAAiB,MAAjB,oBACFD,OADE,EADqB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAI7B,GALY;AAMPE,EAAAA,IANO,gBAMFH,OANE,EAMOC,OANP,EAMgB;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AACvBG,cAAAA,GADuB,GACjBN,QAAQ,GAAG,eADM;AAErBO,cAAAA,IAFqB,GAEd;AACXC,gBAAAA,OAAO,EAAE;AACPC,kBAAAA,KAAK,EAAEN,OAAO,CAACM,KADR;AAEPC,kBAAAA,QAAQ,EAAEP,OAAO,CAACO;AAFX;AADE,eAFc;AAAA;AAAA,qBASJX,KAAK,CAACY,IAAN,CAAWL,GAAX,EAAgBC,IAAhB,CATI;;AAAA;AASrBK,cAAAA,QATqB;;AAAA,mBAWvBA,QAAQ,CAACL,IAAT,CAAcM,QAXS;AAAA;AAAA;AAAA;;AAYzBC,cAAAA,OAAO,CAACC,GAAR,CAAYH,QAAZ;AACMI,cAAAA,KAbmB,GAaX,IAAIC,KAAJ,CACZL,QAAQ,CAACL,IAAT,CAAcS,KAAd,IACE,uDAFU,CAbW;AAAA,oBAiBnBA,KAjBmB;;AAAA;AAAA,oBAoBxBJ,QAAQ,CAACL,IAAT,CAAcK,QAAd,CAAuBM,MAAvB,IAAiC,CApBT;AAAA;AAAA;AAAA;;AAqBnBF,cAAAA,MArBmB,GAqBX,IAAIC,KAAJ,CACZL,QAAQ,CAACL,IAAT,CAAcS,KAAd,IACE,+DAFU,CArBW;AAAA,oBAyBnBA,MAzBmB;;AAAA;AA4BrBG,cAAAA,SA5BqB,GA4BT,CAAC,GAAD,GAAO,IA5BE;AA6BrBC,cAAAA,cA7BqB,GA6BJ,IAAIC,IAAJ,GAAWC,OAAX,KAAuBH,SA7BnB;AA+B3BI,cAAAA,YAAY,CAACC,OAAb,CAAqB,QAArB,EAA+BZ,QAAQ,CAACa,OAAxC;AACAF,cAAAA,YAAY,CAACC,OAAb,CAAqB,iBAArB,EAAwCJ,cAAxC;AAEAtB,cAAAA,KAAK,GAAG4B,UAAU,CAAC,YAAW;AAC5BxB,gBAAAA,OAAO,CAACE,QAAR,CAAiB,YAAjB;AACD,eAFiB,EAEfe,SAFe,CAAlB;AAIAjB,cAAAA,OAAO,CAACyB,MAAR,CAAe,SAAf,EAA0B;AACxBC,gBAAAA,MAAM,EAAEhB,QAAQ,CAACL,IAAT,CAAcK,QAAd,CAAuB,CAAvB,EAA0B,WAA1B;AADgB,eAA1B;;AAtC2B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAyC5B,GA/CY;AAgDbiB,EAAAA,MAhDa,kBAgDN3B,OAhDM,EAgDG;AACdqB,IAAAA,YAAY,CAACO,UAAb,CAAwB,QAAxB;AACAP,IAAAA,YAAY,CAACO,UAAb,CAAwB,iBAAxB;AAEAC,IAAAA,YAAY,CAACjC,KAAD,CAAZ;AAEAI,IAAAA,OAAO,CAACyB,MAAR,CAAe,SAAf,EAA0B;AACxBC,MAAAA,MAAM,EAAE;AADgB,KAA1B;AAGD,GAzDY;AA0DbI,EAAAA,UA1Da,sBA0DF9B,OA1DE,EA0DO;AAClBA,IAAAA,OAAO,CAACE,QAAR,CAAiB,QAAjB;AACAF,IAAAA,OAAO,CAACyB,MAAR,CAAe,eAAf;AACD;AA7DY,CAAf","sourcesContent":["let timer;\r\nimport axios from \"axios\";\r\nimport routeAPI from \"@/js/api\";\r\n\r\nexport default {\r\n  async login(context, payload) {\r\n    return context.dispatch(\"auth\", {\r\n      ...payload,\r\n    });\r\n  },\r\n  async auth(context, payload) {\r\n    let url = routeAPI + \"auth/usuarios\";\r\n    const data = {\r\n      usuario: {\r\n        email: payload.email,\r\n        password: payload.password,\r\n      },\r\n    };\r\n\r\n    const response = await axios.post(url, data);\r\n    \r\n    if (response.data.hayError) {\r\n      console.log(response);\r\n      const error = new Error(\r\n        response.data.error ||\r\n          'No se puedo autenticar, favor de volverlo a intentar.'\r\n      );\r\n      throw error;\r\n    }\r\n\r\n    if(response.data.response.length <= 0){\r\n      const error = new Error(\r\n        response.data.error ||\r\n          'El usuario o la contraseÃ±a no coincide, favor de verificarlo.'\r\n      );\r\n      throw error;\r\n    }\r\n    \r\n    const expiresIn = +110 * 1000;\r\n    const expirationDate = new Date().getTime() + expiresIn;    \r\n\r\n    localStorage.setItem(\"userId\", response.localId);\r\n    localStorage.setItem(\"tokenExpiration\", expirationDate);\r\n\r\n    timer = setTimeout(function() {\r\n      context.dispatch(\"autoLogout\");\r\n    }, expiresIn);\r\n\r\n    context.commit(\"setUser\", {\r\n      userId: response.data.response[0]['019Activo'],\r\n    });\r\n  },\r\n  logout(context) {\r\n    localStorage.removeItem(\"userId\");\r\n    localStorage.removeItem(\"tokenExpiration\");\r\n\r\n    clearTimeout(timer);\r\n    \r\n    context.commit(\"setUser\", {\r\n      userId: null,\r\n    });    \r\n  },\r\n  autoLogout(context) {\r\n    context.dispatch(\"logout\");\r\n    context.commit(\"setAutoLogout\");\r\n  },\r\n};\r\n"]}]}